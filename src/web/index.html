<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Giao Thoa Tech</title>

    <link rel="icon" type="image/png" href="images/logo.png" />

    <!-- Bootstrap -->
    <link href="../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">

    <!-- Custom Theme Style -->
    <link href="../build/css/custom.css" rel="stylesheet">
  </head>

  <body class="nav-md">
    <div class="container body">
      <div class="main_container">

        <!-- top navigation -->
        <div class="top_nav">
          <div class="nav_menu">
            <nav>

              <ul class="nav navbar-nav">
                <li class="">
                    <h1><img src="images/logo.png" alt="logo" hspace="20"/> Calling Service</h1>
                </li>
                
              </ul>
            </nav>
          </div>
        </div>
        <!-- /top navigation -->

        <!-- page content -->
        <div>

          <div class="row">

            <div class="col-md-4 col-sm-4 col-xs-12">
              <div class="x_panel tile fixed_height_320 overflow_hidden">
                <div class="x_title">
                  <h2>Room 1</h2>
                  <ul class="nav navbar-right panel_toolbox">
                    <li>
                      <i id="status1" class="fa fa-circle green fa-4x"></i>
                    </li>
                  </ul>
                  <div class="clearfix"></div>
                </div>
                <div class="x_content">
                  <div class="row">
                    <div class="col-xs-4">
                      <span class="chart_temp chart" id="chart11" data-percent="0">
                        <span class="celsius"></span>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span class="chart_humit chart" id="chart12" data-percent="0">
                        <span class="percent"></span>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span class="chart_batt chart" id="chart13" data-percent="0">
                        <span class="percent"></span>
                      </span>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-xs-4">
                      <span align="center">
                      <p>Temperature</p>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span align="center">
                      <p>Humidity</p>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span align="center">
                        <p>Battery</p>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-4 col-sm-4 col-xs-12">
              <div class="x_panel tile fixed_height_320 overflow_hidden">
                <div class="x_title">
                  <h2>Room 2</h2>
                  <ul class="nav navbar-right panel_toolbox">
                    <li>
                      <i id="status2" class="fa fa-circle green fa-4x"></i>
                    </li>
                  </ul>
                  <div class="clearfix"></div>
                </div>
                <div class="x_content">
                  <div class="row">
                    <div class="col-xs-4">
                      <span class="chart_temp chart" id="chart21" data-percent="0">
                        <span class="celsius"></span>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span class="chart_humit chart" id="chart22" data-percent="0">
                        <span class="percent"></span>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span class="chart_batt chart" id="chart23" data-percent="0">
                        <span class="percent"></span>
                      </span>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-xs-4">
                      <span align="center">
                      <p>Temperature</p>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span align="center">
                      <p>Humidity</p>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span align="center">
                        <p>Battery</p>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-4 col-sm-4 col-xs-12">
              <div class="x_panel tile fixed_height_320 overflow_hidden">
                <div class="x_title">
                  <h2>Room 3</h2>
                  <ul class="nav navbar-right panel_toolbox">
                    <li>
                      <i id="status3" class="fa fa-circle green fa-4x"></i>
                    </li>
                  </ul>
                  <div class="clearfix"></div>
                </div>
                <div class="x_content">
                  <div class="row">
                    <div class="col-xs-4">
                      <span class="chart_temp chart" id="chart31" data-percent="0">
                        <span class="celsius"></span>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span class="chart_humit chart" id="chart32" data-percent="0">
                        <span class="percent"></span>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span class="chart_batt chart" id="chart33" data-percent="0">
                        <span class="percent"></span>
                      </span>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-xs-4">
                      <span align="center">
                      <p>Temperature</p>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span align="center">
                      <p>Humidity</p>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span align="center">
                        <p>Battery</p>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            

          </div>
          <div class="row">
            <div class="col-md-4 col-sm-4 col-xs-12">
              <div class="x_panel tile fixed_height_320 overflow_hidden">
                <div class="x_title">
                  <h2>Room 4</h2>
                  <ul class="nav navbar-right panel_toolbox">
                    <li>
                      <i id="status4" class="fa fa-circle green fa-4x"></i>
                    </li>
                  </ul>
                  <div class="clearfix"></div>
                </div>
                <div class="x_content">
                  <div class="row">
                    <div class="col-xs-4">
                      <span class="chart_temp chart" id="chart41" data-percent="0">
                        <span class="celsius"></span>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span class="chart_humit chart" id="chart42" data-percent="0">
                        <span class="percent"></span>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span class="chart_batt chart" id="chart43" data-percent="0">
                        <span class="percent"></span>
                      </span>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-xs-4">
                      <span align="center">
                      <p>Temperature</p>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span align="center">
                      <p>Humidity</p>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span align="center">
                        <p>Battery</p>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-4 col-sm-4 col-xs-12">
              <div class="x_panel tile fixed_height_320 overflow_hidden">
                <div class="x_title">
                  <h2>Room 5</h2>
                  <ul class="nav navbar-right panel_toolbox">
                    <li>
                      <i id="status5" class="fa fa-circle green fa-4x"></i>
                    </li>
                  </ul>
                  <div class="clearfix"></div>
                </div>
                <div class="x_content">
                  <div class="row">
                    <div class="col-xs-4">
                      <span class="chart_temp chart" id="chart51" data-percent="0">
                        <span class="celsius"></span>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span class="chart_humit chart" id="chart52" data-percent="0">
                        <span class="percent"></span>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span class="chart_batt chart" id="chart53" data-percent="0">
                        <span class="percent"></span>
                      </span>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-xs-4">
                      <span align="center">
                      <p>Temperature</p>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span align="center">
                      <p>Humidity</p>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span align="center">
                        <p>Battery</p>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-4 col-sm-4 col-xs-12">
              <div class="x_panel tile fixed_height_320 overflow_hidden">
                <div class="x_title">
                  <h2>Room 6</h2>
                  <ul class="nav navbar-right panel_toolbox">
                    <li>
                      <i id="status6" class="fa fa-circle green fa-4x"></i>
                    </li>
                  </ul>
                  <div class="clearfix"></div>
                </div>
                <div class="x_content">
                  <div class="row">
                    <div class="col-xs-4">
                      <span class="chart_temp chart" id="chart61" data-percent="0">
                        <span class="celsius"></span>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span class="chart_humit chart" id="chart62" data-percent="0">
                        <span class="percent"></span>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span class="chart_batt chart" id="chart63" data-percent="0">
                        <span class="percent"></span>
                      </span>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-xs-4">
                      <span align="center">
                      <p>Temperature</p>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span align="center">
                      <p>Humidity</p>
                      </span>
                    </div>
                    <div class="col-xs-4">
                      <span align="center">
                        <p>Battery</p>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          
        </div>
        <!-- /page content -->

        <!-- footer content -->
        <footer>
          <div class="pull-right">
            <b>Calling service</b> by <a href="http://giaothoatech.com">Giao Thoa Technology</a>
          </div>
          <div class="clearfix"></div>
        </footer>
        <!-- /footer content -->
      </div>
    </div>

    <!-- jQuery -->
    <script src="../vendors/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- Chart.js -->
    <script src="../vendors/Chart.js/dist/Chart.min.js"></script>
    <!-- Custom Theme Scripts -->
    <script src="../build/js/custom.min.js"></script>

    <!-- easy-pie-chart -->
    <script src="../vendors/jquery.easy-pie-chart/dist/jquery.easypiechart.min.js"></script>

    
    <!-- /Doughnut Chart -->
    
    <!-- bootstrap-daterangepicker -->
  <script>
      $(document).ready(function() {
        $('.chart_temp').easyPieChart({
          easing: 'easeOutBounce',
          lineWidth: '6',
          barColor: function (percent) {
            return (percent < 35 ? '#5cb85c' : percent < 40 ? '#f0ad4e' : '#cb3935');
          },
          onStep: function(from, to, percent) {
            percent = Math.round(percent);
            if (percent <= 0){
              percent = "-";
            } else if (percent >= 100){
              percent = 100;
            }
            $(this.el).find('.celsius').text(percent);
          }
        });
        $('.chart_humit').easyPieChart({
          easing: 'easeOutBounce',
          lineWidth: '6',
          barColor: function (percent) {
            return (percent < 60 ? '#5cb85c' : percent < 70 ? '#f0ad4e' : '#cb3935');
          },
          onStep: function(from, to, percent) {
            percent = Math.round(percent);
            if (percent <= 0){
              percent = "-";
            } else if (percent >= 100){
              percent = 100;
            }
            $(this.el).find('.percent').text(percent);
          }
        });
        $('.chart_batt').easyPieChart({
          easing: 'easeOutBounce',
          lineWidth: '6',
          barColor: function (percent) {
            return (percent <= 5 ? '#cb3935' : percent <= 20 ? '#f0ad4e' : '#5cb85c');
          },
          onStep: function(from, to, percent) {
            percent = Math.round(percent);
            if (percent <= 0){
              percent = "-";
            } else if (percent >= 100){
              percent = 100;
            }
            $(this.el).find('.percent').text(percent);
          }
        });
        function worker() {
          $.ajax({
            url: '/data', 
            success: function(data) {
              console.log(data);
              var room_map = JSON.parse(data);
              room_map.forEach(function(room) {
                  console.log(room.id);
                  var chart_temp = window.chart = $('#chart' + room.id + '1').data('easyPieChart');
                  chart_temp.update(room.temp);
                  var chart_humit = window.chart = $('#chart' + room.id + '2').data('easyPieChart');
                  chart_humit.update(room.humit);
                  var chart_batt = window.chart = $('#chart' + room.id + '3').data('easyPieChart');
                  chart_batt.update(room.battery);
                  if(room.status == 0){
                    $('#status' + room.id).removeClass('red').removeClass('yellow').addClass('green');
                  } else if (room.status == 1){
                    $('#status' + room.id).removeClass('green').removeClass('yellow').addClass('red');
                  } else if (room.status == 2){
                    $('#status' + room.id).removeClass('red').removeClass('green').addClass('yellow');
                  }
                  
              });
            },
            complete: function() {
              // Schedule the next request when the current one's complete
              setTimeout(worker, 5000);
            }
          });
        }
        worker();
      });
    </script>
  </body>
</html>
